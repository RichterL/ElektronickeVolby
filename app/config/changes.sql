ALTER TABLE `question`
DROP `multiple`,
ADD `min` tinyint(2) NOT NULL DEFAULT '1',
ADD `max` tinyint(2) NOT NULL DEFAULT '1' AFTER `min`;

ALTER TABLE `voter_file`
    CHANGE `content` `content` mediumblob NOT NULL AFTER `filename`;

DROP TABLE `vote`;

CREATE TABLE `ballot` (
    `id` int(11) NOT NULL AUTO_INCREMENT,
    `election_id` int(11) NOT NULL,
    `encrypted_data` text NOT NULL,
    `encrypted_key` text NOT NULL,
    `hash` varchar(100) NOT NULL,
    `signature` text NOT NULL,
    `added_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `decrypted_data` text DEFAULT NULL,
    `decrypted_key` text DEFAULT NULL,
    `decrypted_at` datetime DEFAULT NULL,
    `decrypted_by` int(11) DEFAULT NULL,
    `counted_at` timestamp NULL DEFAULT NULL,
    `counted_by` int(11) DEFAULT NULL,
    PRIMARY KEY (`id`),
    KEY `election_id` (`election_id`),
    KEY `decrypted_by` (`decrypted_by`),
    KEY `counted_by` (`counted_by`),
    CONSTRAINT `ballot_ibfk_1` FOREIGN KEY (`election_id`) REFERENCES `election` (`id`) ON DELETE CASCADE,
    CONSTRAINT `ballot_ibfk_2` FOREIGN KEY (`decrypted_by`) REFERENCES `user` (`id`),
    CONSTRAINT `ballot_ibfk_3` FOREIGN KEY (`counted_by`) REFERENCES `user` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

ALTER TABLE `election`
    ADD `encryption_key` text COLLATE 'utf8_unicode_ci' NULL AFTER `end`;
ALTER TABLE `election`
    ADD `signing_key` text COLLATE 'utf8_unicode_ci' NOT NULL AFTER `encryption_key`;
ALTER TABLE `election`
    ADD `decryption_key` text COLLATE 'utf8_unicode_ci' NULL AFTER `encryption_key`;
ALTER TABLE `election`
    ADD `results` text COLLATE 'utf8_unicode_ci' NULL AFTER `signing_key`;

ALTER TABLE `acl_rule`
    DROP FOREIGN KEY `acl_rule_ibfk_3`,
    ADD FOREIGN KEY (`privilege_id`) REFERENCES `acl_resource_privilege` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT
ALTER TABLE `acl_rule`
    DROP FOREIGN KEY `acl_rule_ibfk_2`,
    ADD FOREIGN KEY (`resource_id`) REFERENCES `acl_resource` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT

ALTER TABLE `ballot`
    DROP `added_at`;

INSERT INTO `ballot` (`id`, `election_id`, `encrypted_data`, `encrypted_key`, `hash`, `signature`, `added_at`, `decrypted_data`, `decrypted_key`, `decrypted_at`, `decrypted_by`, `counted_at`, `counted_by`) VALUES
(1,	1,	'47ENw+6msXxjxfy+TfQlUV05/Mg1M1lGtdzosi3kAUKuoWkSaUDesMMZzfgMVhWJfjesekU+0+JKUMXqj/bE58qI3/qlj1RUgP9BChlNxwEyoTuNGOfBFxmFw5Q=',	'vKZbfeRXUyQceRKD0/Rdm0hUInfgKV76FMQMjeOH6ChEPD1rml6ikyNByvhhKL9Eqj3huh9YEuFNunziQ/DfazEMIAYc+VD9CH+my/tevJXIFejSJPvOXoDD4sD5yzr1srhSRioBiHTCtHrdEjO2iEZ0rpnrsmOeYV7n8rVJGmiWPsosbQ7ufSgvsLI1porHvtym1td18vBsz7oI6LZjdl4ReE2Lx0IT67CYGSXbHGbSImlGf8Tl6gqyIunuldey0s7zVeHIZb083vc/FtaUPcXLhyZ3+Yh1GWSn7E32CY3vW8zetsuYPqxGNGPvB169CdoIVIu+J+bW/3ZRNe8VFQ==',	'528c39b1c2dea803d4404a9a0c0e3fbf6977a9b19dc7a8bbf12af815ddd62af9',	'b301a26203a906b99f484fe88664b7f1cd080ff6e318fa32fa23601ff3e03473a2e4899fddc1229b76d7188fe5da4898d11210779b24e260365af321dfabf483cee61d0c83bbc89f30ccd322dcf758a0f7512e57e480f938e7661bba76d54f63cbcef1d6faf595965c90a9460a8b6cbb006258a9b7992c6d5abf55e12162bf49be6259c65d86d2c7173896664331d4f479ec9ae6569e5b66cbac80a02fb3506a8eddbefe81454eb2a7e3c63f99d1b91f135e0e36c698e205bb33240f019b0fdc9d07513a5c7cc50bd95bda1da4acb26ad5f12e1783001976a27364cd0739d0be88a5ddb6eeb5d5f4d8a55b910e46c45f7de3c588d0ce0e2566449096e5519175',	NULL,	NULL,	NULL,	NULL,	NULL,	NULL),
(2,	1,	'I9kzcjQBOCevhx/l1tllDByr+qKsGvptDVFjsrqClkDjOTXwVOuxBtT6u+Y9qihGOjkk4VG8URtxlAaSL77gb2QumXNqimk4CL8MMq1EYVq9vb9Zoc4YFsvwRHw=',	'ZWrTMgubDJugXlwD+UgZ9igItzbqMl6paD6I4h2uzmTykNRDDiF9TTfzKHhao2hV0zxjYQn7U2a8u+9TI6g7tv/sczFlu/Z1QsqFOXKiQ8kMt+YON7BiftyLLdyQznc98QDPd3y/KcZicgOV563SuqCksd6/K98uZT/vaD00CEvFtSZVyFdaFUDB2FK8YbxWbkCcATbwyG7HilerZPV1auAlFoXM27RMI5QB5eR3UseXhXw0fwoO6Vsq8BQ95Zz4579CXz4VexmDK+rcbHXl2G5IEW2EIJO45omHqWMqcdcnm/sq/HL3oSkTEQC30w/fBh6uxt05ioGAtqmrDQyvnQ==',	'57678cf32ad27ffbb6977fc51ebbaa1269458d9f0a0cbb5dfd4e72a069c04e18',	'9fe4ccd8f0d727eaa1804b4e07bc3315a843aabb3788312e682fad65c76e794a05e89f91f27ed76984e6d54cdcf72842dc435b116622b25b52285b3f3467e5b8eba30cfb2b0e61343dede32aea042e37e3b53251d16c9c2b15689aaa78e175ee0006d2d22b3892ece5de2aeb0b766623f6f2bb4e631ecc9f9c0b3e45445f37bab32e4a3c4081989b73175069475c1ce60ffae65012a082df555cbb7d94dfcf3d1073b33652d973fde7f7e1ffe92215b210bcef9befb748d986aca5355a86b776ee540addd930ce096e56294343bf413d5fed62672e1ac3f96352f13901a5d538cf4ab88cf0645a4d1e5d9638cae06b04b716c730436624c2a14b226b559601ec',	NULL,	NULL,	NULL,	NULL,	NULL,	NULL),
(3,	1,	'T3PzzUtOhj98b/GWP7meWm2uPt9ei4RR4dfpfeYZ2I3oacsmYcgTz0dV9Ww6kunoFVi/3qCdcNWizlbqbg2+OHPm1y26LpcyaSiR2JZRv1HZFhAVqwLEVjbpDYbHNQgrz9sUG1F6lQQE999bBYJlHF3G204EjRpw',	'mSSzFPuf6Ig5av8NW9XjDvjhxzjO40QIo12iO47e/++IvdDL1hw1JqkV6o2W7NTafOwb4CRzrPjAlMG6tlGziLE0aGsMQYJe/MvjH50VS9EtnPe03WijrUgI2Uv1bm4EIkLuikpQj6M1fCKkdy4xaXTKIIsnMFGAKi9GeA0C3iZdlApOLwPOKI/kGIICDvnfMBmfLl0ig5Dd2qWkQhUbbsmyB5y2buzz6humPzrasLakB9oZyNvLzmh6QVPFJKOXvhYtT65beK/yZOj6k2ynkhgDhLsxuYoe9QsLPlmQcfPl/qiQavAhvOyBwF1sbg0q66kUDTAC2M5la0U8b5iMsw==',	'0f4f89cf3b86544053f3fc3ce8f27b0a78220237ef766fa677896890858367a0',	'8c9fae0d13e86094aa3d097dbbf5509d7d49fc88c9479ff5be430ed8839a079397756ae0cc7cb9cad745c11a58bf9c799411320d4c347ed329f801ba20b72a4b8edfec3bd7372a5f2348c71701375f09f1237d9f192bd26cb03755aaf2d63322b9d96f45830f706552437f1fd8f8cbb2c718ff658e91bb96aa3e30fe69584a1b840c1892c6222644223891c69e2ee01c0402530a0b9edde9793c3cd55d3bf3bac0da5e554a1f7f7ecf152e0e8d28b92edacf7f8e90f3b4c62780866d580e18d2e0779a8e8664a8fb9fa85193b78606c71cd0e8efa14b09ee26124cd0744174afd13e195834c033b8c6cd8dcbc299c42377ac010d33f1a2196cb9bad6aa5201fd',	NULL,	NULL,	NULL,	NULL,	NULL,	NULL),
(4,	1,	'20pkg6oYkfW60gX5IbANEi6Nzlu0SkSNxFJ5JiwRgA+aN3YxAcIPiUEX5BwpSYbSFcvcyQy4Wy62VSduLdHQvc5ev5U+FZXKMin2/tyX8+BnkhTcn5iaufVsFETJdP4AeGuNVpVLi7q0Su+SugBPJCslpAGBbvY=',	'hbcEBg5ogGgR4ZtCvmW3bCu/zDj+LKCzra5yV+vamIutIR488dM0I2dms79DSFnm1lvxkZC1rtJgd8tr1SqKdUcCK9GJgZgx/QKW3iSXSprpQ1on9DrDubjXTKkbW8ZiabNJXyxzAoV4zZ/PKDXyaW/UPbHzGBOcrTZMYjh4iupem4TYejFxhpZDcdmlyiAMPqoXlU0eV+h6lbdhbD85+eY+REPAHb4rZqDNIBYfyGO3gvAV9prfVTtkEDcsaLLiNT+dOVs/I71uCeWyYC6iyyVKAfkB0m+EMptYisBav2iGoqwtTh6HotYwJ75w4imIl4xnXkiD+B+BWRkh0zqtlw==',	'f63a4bf203fb3df639ca16681b7a15aaab20b08083afb7272f8b953b86b88d97',	'6d3d1764081a50939756bed1c5de41ac3a738a533e969dff910732d776510b230a7aaa3885020a88649079a5e386f387252ff49e4dedc8963c27001cc04989b19741dfc2d6256f23da07daf3e3a6c6a90b7e7455e6c7d99745c1ce8d7bc7f1d3ad6c9ea9abefa97e89e1962f72fd865c417cef7cdce0acc963ed07ba3fc23c40e16a5ed3b59f718b1856a8e40003645f0a3170538a339151306dbdc3013e93c148a221a525fc09547b4d39055d379beabed7c82435a9d6e0e2354196f15607ec8b61235454126effc38d35d20f4b3810fb179e2252ff82753f90566fe072b5d221bc294ace11627d5fa4ce3dcfbfcb4664ea8f32bf8a586a1c9837225fd539f0',	NULL,	NULL,	NULL,	NULL,	NULL,	NULL),
(5,	1,	'3K9Teeft25MAbeF3CKizUypB5opWJZU8VPx/Y9AsQg4+hpghTlfkrh/2RrXG7FAb+qRKfYfrDWYZlp67yzGA/9jKotJHzbaV16OCRgwo9NB5nONQ0skvKGTpD2yfMzy7kHbtHPs21k6o7YXEQQtzQYB/FLWJwc9s',	'U2Vod8pj5ZTs4iJ0pqjvRWbAyzoBOJY8KM8x9Pc1KQZD3SOcDfaNneOnmMcdHloqAmtnLFMWw3ke+M1fQYRjrvBhLaj/2uGnPTqDHS1wlgMkz2Rbb1LSGpzPkM6Sk9qgXidpXynJuhJyrei07gnEGDrMMSuPB9mJpPykb9oMaKkZL3U6zdkGWkfn+HIMPTCQAL51dE7DDaJPqa1aQ3syfoyAEXlDHU+F4J9bSHHS5fYUHZilnKeKldIUegWiMgia2kRzsdcfuHSOzfmhs+9H2whgrHy6Qm9ygR7CzwDELr8A/NlJdfBjSnEo+MNrAPKziej6NqMVwWlOn0NOTc9ZoQ==',	'7b21ca764fc0e7e22f4601c6973a26ca219b567ac4e256993eff61a205db9316',	'19ca55d4d57fbdff2046f73fc9713187824ded18bb460b2b88e925e7e34f7be72708529c0275861f6ca02cccb1c8770cdb2ef6fbb75372a356316eaaf1ca55100a732a5b9e499d180c1b0789552bd2a902297558a3a067fa7ec728361bbe5b3d4552abe74541a196a53ec1c2bfd0939d1ee5b286ee8da95b8256b04c06713702b4533a6fa25431d9db0500d199905c5a0f34ebc650f03922353be3615089d1c24e06ef22d4124b914dcca0ec36ca6789cd2986c4821ee60ed1fe0672278ccd984ec7131618fbe0e429de0dad5e9494968f0de17780c7868049f5cf01be09ca4d944c68fa173b4d0db1fe290331d78941384b39bf6f0b8411a1ab41d91beb7499',	NULL,	NULL,	NULL,	NULL,	NULL,	NULL);

